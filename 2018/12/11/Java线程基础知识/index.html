<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.8.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Java线程基础知识 - Mr.Crowley博客</title>









<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">



<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-1-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="Java线程基础知识" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-end">
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-12 has-order-2 column-main">
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2018-12-11T15:33:16.000Z">2018-12-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Java/">Java</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    10 minutes read (About 1553 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Java线程基础知识
            
        </h1>
        <div class="content">
            <h1 id="Java线程基础"><a href="#Java线程基础" class="headerlink" title="Java线程基础"></a>Java线程基础</h1><p>如下图所示，Java中线程可分为NEW，RUNABLE，RUNING，BLOCKED，WAITING，TIMED_WAITING，TERMINATED 共七个状态，一个状态是如何过渡到另一个状态图中标识的很清楚。</p>
<p><img src="http://syxtt.xin/%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81.png" alt="img"></p>
<ul>
<li><p><strong>初始状态（NEW）</strong><br>实现Runnable接口和继承Thread可以得到一个线程类，new一个实例出来，线程就进入了初始状态。</p>
</li>
<li><p><strong>就绪状态（RUNNABLE）</strong><br>就绪状态只是说你资格运行，调度程序没有挑选到你，你就永远是就绪状态。</p>
<ul>
<li>调用线程的<strong>start()</strong>方法，此线程进入就绪状态。</li>
<li>当前线程sleep()方法结束，其他线程join()结束，等待用户输入完毕，某个线程拿到对象锁，这些线程也将进入就绪状态。</li>
<li>当前线程时间片用完了，调用当前线程的yield()方法，当前线程进入就绪状态。</li>
<li>锁池里的线程拿到对象锁后，进入就绪状态。</li>
</ul>
</li>
<li><p><strong>运行中状态（RUNNING）</strong><br>线程调度程序从可运行池中选择一个线程作为当前线程时线程所处的状态。这也是线程进入运行状态的唯一一种方式。</p>
</li>
<li><p><strong>阻塞状态（BLOCKED）</strong><br>阻塞状态是线程阻塞在进入synchronized关键字（当然也包括ReentrantLock）修饰的方法或代码块(获取锁)时的状态。</p>
</li>
<li><p><strong>等待（WAITING）</strong><br>处于这种状态的线程不会被分配CPU执行时间，它们要等待被显式地唤醒，否则会处于无限期等待的状态。</p>
</li>
<li><p><strong>超时等待（TIMED_WAITING）</strong><br>处于这种状态的线程不会被分配CPU执行时间，不过无须无限期等待被其他线程显示地唤醒，在达到一定时间后它们会自动唤醒。</p>
</li>
<li><p><strong>终止状态（TERMINATED）</strong><br>当线程的run()方法完成时，或者主线程的main()方法完成时，我们就认为它终止了。这个线程对象也许是活的，但是，它已经不是一个单独执行的线程。线程一旦终止了，就不能复生。在一个终止的线程上调用start()方法，会抛出java.lang.IllegalThreadStateException异常。</p>
</li>
</ul>
<h1 id="Java线程常用API"><a href="#Java线程常用API" class="headerlink" title="Java线程常用API"></a>Java线程常用API</h1><p><img src="http://syxtt.xin/Thread%E6%96%B9%E6%B3%95%E9%9B%86%E5%90%88.png" alt="img"></p>
<p>其中常用的方法为start()，yield()，sleep()，interrupt()，interrupted()，isInterrupted()，isAlive()，join()，</p>
<p>setDaemon()，setName()，setPriority()，其中stop方法和destroy方法，都是被废弃的方法在日常使用中不建议用。除了Thread类下的API，Object类下的wait()，notify()，notifyAll()，这三个方法也经常在多线程场景中出现。本文的目的，主要讲解的就是这些方法的使用和内部原理。</p>
<table>
<thead>
<tr>
<th>方法</th>
<th style="text-align:left">方法说明</th>
<th style="text-align:left">Exception</th>
</tr>
</thead>
<tbody>
<tr>
<td>Thread.start</td>
<td style="text-align:left">开启执行线程，由虚拟机负责调用run方法。（Causes this thread to begin execution; the Java Virtual Machine calls the <code>run</code> method of this thread.）</td>
<td style="text-align:left">IllegalThreadStateException  if the thread was already       started.</td>
</tr>
<tr>
<td>Thread.yield</td>
<td style="text-align:left">让出CPU，但是仅仅对同线程级别（Yield is a heuristic attempt to improve relative progression between threads that would otherwise over-utilise a CPU）</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td>Thread.sleep</td>
<td style="text-align:left">使得正在执行的当前线程睡眠。敲黑板！但是<strong>不会让出任何锁的所有权</strong>（ The thread does not lose ownership of any monitors.）这个特性很重要，也就是说在同步块中使用Thread.sleep要谨慎。</td>
<td style="text-align:left">当线程中断会抛出InterruptedException异常，并<strong>同时清空中断标志位</strong></td>
</tr>
<tr>
<td>Thread.interrupt</td>
<td style="text-align:left">中断线程，但只是设置了中断标志位，此刻调用isInterrupted返回true。例子请参考下面的示例代码testInterrupt0方法。只会打印到0-9循环跳出</td>
<td style="text-align:left">SecurityException if the current thread cannot modify this thread 请教这个异常什么时候会发生呢？</td>
</tr>
<tr>
<td>Thread.isInterrupted</td>
<td style="text-align:left">查看线程是否处于中断状态.true为中断。调用之后<strong>不清除</strong>中断标志位。</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td>Thread.interrupted</td>
<td style="text-align:left">查看线程是否处于中断状态.true为中断。调用之后<strong>清除</strong>中断标志位。心细的同学已经发现和isInterrupted的区别了吧。</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td>Thread.isAlive</td>
<td style="text-align:left">线程是否存活，A thread is alive if it has  been started and has not yet died.</td>
<td style="text-align:left">无</td>
</tr>
<tr>
<td>Thread.join</td>
<td style="text-align:left">等待线程死亡之后再执行。（Waits for this thread to die）</td>
<td style="text-align:left">当线程中断会抛出InterruptedException异常，并<strong>同时清空中断标志位</strong></td>
</tr>
<tr>
<td>Thread.setDaemon</td>
<td style="text-align:left">设置为守护线程。任何非守护线程还在运行，守护线程就不会终止，最典型的守护线程是垃圾回收器的回收线程。</td>
<td style="text-align:left">IllegalThreadStateException 当线程状态是alive的时候不能调用setDaemon</td>
</tr>
<tr>
<td>Thread.setName</td>
<td style="text-align:left">设置线程的name</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>Thread.setPriority</td>
<td style="text-align:left">设置线程的优先级。MIN_PRIORITY为1，MAX_PRIORITY为10，NORM_PRIORITY为5。</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>Object.wait</td>
<td style="text-align:left">如果不指定timeout，则一直阻塞直到其他线程调用notify或者notifyAll。敲黑板！调用wait之后当前线程不在持有对象锁。</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>Object.notify</td>
<td style="text-align:left">随机唤醒同一个对象monitor下的某个线程</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>Object.notifyAll</td>
<td style="text-align:left">唤醒同一个对象monitor下的所有线程。查看testNotify示例。</td>
</tr>
</tbody>
</table>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testInterrupt0</span><span class="hljs-params">()</span>  Exception </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;</span><br><span class="line">    <span class="hljs-keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"loop"</span> + i++);</span><br><span class="line">        <span class="hljs-keyword">if</span>(i == <span class="hljs-number">10</span>) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//echo true</span></span><br><span class="line">    System.out.println(Thread.currentThread().isInterrupted());</span><br><span class="line">    <span class="hljs-comment">//echo true</span></span><br><span class="line">    System.out.println(Thread.currentThread().interrupted());</span><br><span class="line">    <span class="hljs-comment">//echo false</span></span><br><span class="line">    System.out.println(Thread.currentThread().isInterrupted());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> Object lock;</span><br><span class="line">    <span class="hljs-keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyThread</span><span class="hljs-params">(Object lock, String name)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.lock = lock;</span><br><span class="line">        <span class="hljs-keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                System.out.println(name + <span class="hljs-string">" get lock,interrupt ="</span> + Thread.currentThread().isInterrupted());</span><br><span class="line"></span><br><span class="line">                lock.wait();</span><br><span class="line"></span><br><span class="line">                <span class="hljs-comment">//Thread.sleep(2000);</span></span><br><span class="line">            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                System.out.println(name + <span class="hljs-string">" is interrupt. notify all interrupt ="</span> + Thread.currentThread().isInterrupted());</span><br><span class="line">                lock.notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(name + <span class="hljs-string">":notified..."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testNotify</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    MyThread t1 = <span class="hljs-keyword">new</span> MyThread(lock, <span class="hljs-string">"t1"</span>);</span><br><span class="line">    MyThread t2 = <span class="hljs-keyword">new</span> MyThread(lock, <span class="hljs-string">"t2"</span>);</span><br><span class="line"></span><br><span class="line">    Thread thread1 = <span class="hljs-keyword">new</span> Thread(t1);</span><br><span class="line">    Thread thread2 = <span class="hljs-keyword">new</span> Thread(t2);</span><br><span class="line"></span><br><span class="line">    thread1.start();</span><br><span class="line">    thread2.start();</span><br><span class="line"></span><br><span class="line">    Thread.sleep(<span class="hljs-number">1000</span>);</span><br><span class="line">    <span class="hljs-keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">    <span class="hljs-keyword">synchronized</span> (lock) &#123;</span><br><span class="line">        System.out.println(<span class="hljs-string">"main get lock"</span>);</span><br><span class="line">        lock.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    thread1.join();</span><br><span class="line">    thread2.join();</span><br><span class="line">    <span class="hljs-keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="hljs-string">"notify lock.time ="</span> + (endTime - startTime));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>testNotify执行结果</strong>：</p>
<p>t1 get lock,interrupt =false<br>t2 get lock,interrupt =false<br>main get lock<br>t2:notified…<br>t1:notified…</p>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/java/">java</a>, <a class="has-link-grey -link" href="/tags/线程/">线程</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">Suka dengan artikel ini? Bantu penulis dengan donasi melalui</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>Wechat</span>
    <div class="qrcode"><img src="/gallery/donate/wechat.jpg" alt="Wechat"></div>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2018/12/11/单例模式/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">单例模式</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2018/12/11/java创建对象的流程/">
                <span class="level-item">Java对象刨根问底</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Comentarios</h3>
        
<div id="SOHUCS" sid="2018/12/11/Java线程基础知识/"></div>
<script charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/changyan.js" ></script>
<script type="text/javascript">
window.changyan.api.config({
    appid: 'cyrXKIcmH',
    conf: './'
});
</script>

    </div>
</div>
</div>
                
                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="Java线程基础知识" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 Mr.Crowley&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-Hans");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'true'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>




<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Entradas',
                PAGES: 'Pages',
                CATEGORIES: 'Categorias',
                TAGS: 'Etiquetas',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>